@tailwind base;
@tailwind components;
@tailwind utilities;

/* Design System Variables (Industrial Cinematic Palette) */
:root {
  /* Primary (Orange Core) */
  --color-primary: #E97400; /* Burnt Orange */
  --color-primary-hover: #FF9E32; /* Amber Glow */
  --color-primary-active: #B15A00; /* Deep Ember */
  --color-primary-accent: #FFBB66; /* Soft Apricot */
  --color-error: #E63B00; /* Fire Red */

  /* Dark scale */
  --color-black: #0D0D0D; /* Carbon Black */
  --color-dark-grey: #1F1F1F; /* Iron Grey */
  --color-mid-grey: #3C3C3C; /* Slate */

  /* Light neutrals */
  --color-smoke: #E0E0E0; /* Smoke */
  --color-mist: #F2F2F2; /* Mist */
  --color-white: #FFFFFF; /* Pure White */

  /* Existing legacy tokens mapped for backward compatibility */
  --dark-primary: var(--color-black);
  --dark-secondary: var(--color-dark-grey);
  --dark-card: #232323; /* Preserve previous dark card tone for depth */
  --dark-border: #2A2A2A; /* Transitional border */
  --dark-elevated: #2D2D2D; /* Elevated surface */

  /* Legacy orange mapped to new primary */
  --orange-primary: var(--color-primary);
  --orange-hover: var(--color-primary-hover);
  --orange-dark: var(--color-primary-active);
  --orange-light: var(--color-primary-accent);

  /* Text colors */
  --text-primary: var(--color-white);
  --text-secondary: #A0A0A0;
  --text-tertiary: #666666;
}

/* Optional light theme hook (can be enabled via class or data attribute) */
.theme-light, [data-theme='light'] {
  --dark-primary: var(--color-mist);
  --dark-secondary: var(--color-smoke);
  --dark-card: var(--color-white);
  --dark-border: #E0E0E0;
  --dark-elevated: var(--color-smoke);
  --text-primary: #0D0D0D;
  --text-secondary: #3C3C3C;
  --text-tertiary: #555555;
}

@layer base {
  html {
    height: 100%;
  }
  body {
    height: 100%;
    font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
    -webkit-font-smoothing: antialiased;
    background-color: var(--dark-primary);
    color: var(--text-primary);
  }
  
  /* Comprehensive fix for dropdown positioning issues */
  * {
    /* Reset any transforms that might affect dropdown positioning */
    backface-visibility: visible !important;
  }
  
  /* Force proper positioning for select elements */
  select {
    transform: none !important;
    perspective: none !important;
    transform-style: flat !important;
    contain: none !important;
    will-change: auto !important;
    position: relative !important;
  }
  
  /* Ensure select dropdowns are not affected by parent transforms */
  select option {
    transform: none !important;
    position: static !important;
  }
  
  /* Additional fixes for dropdown positioning */
  select:focus {
    contain: none !important;
    transform: none !important;
  }
  
  /* Prevent backdrop filters from affecting dropdowns */
  .modal-backdrop,
  .backdrop-blur,
  .backdrop-blur-sm {
    contain: none !important;
  }
  
  /* Fix for modal containers that might affect dropdowns */
  .fixed {
    contain: none !important;
  }
  
  /* Force browser to treat select as uncontained */
  select,
  select * {
    contain: none !important;
    isolation: auto !important;
  }
  
  /* Reset any CSS that might create stacking contexts */
  [class*="transform"],
  [class*="scale"],
  [class*="translate"],
  [class*="rotate"] {
    contain: none !important;
  }
  
  /* Specific fix for Tailwind transforms */
  .transform,
  .scale-105,
  .scale-110 {
    contain: none !important;
  }
  
  /* Specific dropdown positioning fix */
  .dropdown-fix {
    position: static !important;
    transform: none !important;
    contain: none !important;
    isolation: auto !important;
    perspective: none !important;
    transform-style: flat !important;
    backface-visibility: visible !important;
    will-change: auto !important;
    zoom: 1 !important;
  }
  
  /* Force dropdown to ignore parent containment */
  .dropdown-fix,
  .dropdown-fix * {
    contain: none !important;
  }
  
  /* Additional aggressive reset for dropdown containers */
  .dropdown-fix {
    /* Force the browser to treat this as uncontained */
    contain: none !important;
    /* Reset any transform origin */
    transform-origin: 0 0 !important;
    /* Ensure no transform is inherited */
    transform: translate3d(0, 0, 0) !important;
    /* Remove any perspective */
    perspective: none !important;
    /* Flatten transform style */
    transform-style: flat !important;
    /* Reset filter effects */
    filter: none !important;
    /* Reset backdrop filter */
    backdrop-filter: none !important;
    /* Ensure proper positioning context */
    position: relative !important;
    /* Reset any mask */
    mask: none !important;
    clip-path: none !important;
  }
}

@layer components {
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 0.375rem; /* rounded-md */
    font-size: 0.875rem; /* text-sm */
    font-weight: 500; /* font-medium */
    transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, box-shadow, transform, filter, backdrop-filter;
    transition-duration: 150ms;
    outline: none;
  }
  /* Badge & Icon helpers (Semantic Palette) */
  .badge-primary {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.5rem; /* px-2 py-1 */
    font-size: 0.625rem; /* text-xs */
    font-weight: 500;
    line-height: 1;
    border-radius: 0.5rem; /* rounded-lg */
    background: color-mix(in srgb, var(--color-primary) 15%, transparent);
    color: var(--color-primary-accent);
    border: 1px solid color-mix(in srgb, var(--color-primary) 30%, transparent);
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }
  .badge-primary[data-variant="subtle"] {
    background: var(--dark-elevated);
    color: var(--color-primary);
    border-color: var(--dark-border);
  }
  .badge-danger {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.5rem;
    font-size: 0.625rem;
    font-weight: 500;
    line-height: 1;
    border-radius: 0.5rem;
    background: color-mix(in srgb, var(--color-error) 15%, transparent);
    color: var(--color-error);
    border: 1px solid color-mix(in srgb, var(--color-error) 30%, transparent);
    letter-spacing: 0.5px;
    text-transform: uppercase;
  }
  .icon-accent {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border-radius: 0.75rem; /* rounded-xl */
    background: var(--dark-elevated);
    padding: 0.75rem; /* p-3 */
    box-shadow: inset 0 0 0 999px rgba(0,0,0,0.02);
    position: relative;
  }
  .icon-accent::after {
    content: "";
    position: absolute;
    inset: 0;
    border-radius: inherit;
    pointer-events: none;
    box-shadow: 0 0 0 1px color-mix(in srgb, var(--color-primary) 40%, transparent);
  }
  .icon-accent[data-variant="danger"]::after {
    box-shadow: 0 0 0 1px color-mix(in srgb, var(--color-error) 50%, transparent);
  }
  .accent-bar {
    position: absolute;
    inset-inline: 0;
    bottom: 0;
    height: 4px;
    background: linear-gradient(90deg,var(--color-primary),var(--color-primary-hover),var(--color-primary-active));
  }
  .btn:disabled {
    opacity: .5;
    pointer-events: none;
  }
  
  .btn-primary {
    background: var(--color-primary);
    color: var(--color-white);
    font-weight: 500;
    box-shadow: 0 2px 4px rgba(0,0,0,0.3);
    transition: background-color .15s ease, box-shadow .15s ease;
  }
  .btn-primary:hover {
    background: var(--color-primary-hover);
  }
  .btn-primary:active {
    background: var(--color-primary-active);
  }
  .btn-primary:focus-visible {
    outline: 2px solid var(--color-primary-hover);
    outline-offset: 2px;
  }
  
  .btn-secondary {
    background: var(--dark-elevated);
    color: var(--text-primary);
    border: 1px solid var(--dark-border);
    transition: background-color .15s ease, border-color .15s ease;
  }
  .btn-secondary:hover {
    background: var(--dark-card);
    border-color: var(--color-primary);
  }
  
  .btn-danger {
    background: var(--color-error);
    color: var(--color-white);
    font-weight: 500;
    transition: filter .15s ease;
  }
  .btn-danger:hover {
    filter: brightness(1.1);
  }
  .btn-danger:active {
    filter: brightness(0.9);
  }
  
  .card {
    background: linear-gradient(to bottom, #1a1a1a, #232323);
    border-radius: 0.5rem; /* rounded-lg */
    box-shadow: 0 1px 3px 0 rgba(0,0,0,.1),0 1px 2px -1px rgba(0,0,0,.1);
    border: 1px solid var(--dark-border);
  }
  
  .input {
    display: block;
    width: 100%;
    border-radius: 0.375rem; /* rounded-md */
    border: 1px solid var(--dark-border);
    background: var(--dark-elevated);
    color: var(--text-primary);
    font-size: 0.875rem; /* sm:text-sm */
    line-height: 1.25rem;
    padding: 0.5rem 0.75rem;
  }
  .input:focus {
    border-color: var(--orange-primary);
    box-shadow: 0 0 0 3px rgba(233,116,0,0.3);
    outline: none;
  }
  
  .table {
    min-width: 100%;
    border-collapse: collapse;
  }
  
  .table-header {
    background: var(--dark-card);
  }
  
  .table-cell {
    padding: 1rem 1.5rem; /* px-6 py-4 */
    white-space: nowrap;
    font-size: 0.875rem;
    color: var(--text-primary);
  }
  
  /* Fix for dropdown positioning issues */
  .dropdown-container {
    contain: none !important;
    transform: none !important;
  }
  
  /* Ensure select elements are positioned correctly */
  select {
    contain: none !important;
    will-change: auto !important;
  }
  
  /* Fix for forms inside modals */
  .modal-form {
    contain: none !important;
    transform: none !important;
  }
  
  /* Ensure proper stacking context for dropdowns */
  form {
    contain: none !important;
  }
}